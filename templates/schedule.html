<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SSP Scheduler</title>
    <link rel="stylesheet" href="{% static "schedule.css" %}">
    <link rel="stylesheet" href="{% static "bootstrap.css" %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://files.codepedia.info/files/uploads/iScripts/html2canvas.js"></script>


</head>
<body>
<div class="container">
    <form action="/schedule/" method="post" >
        {% csrf_token %}
        <div class="row">
            {% for course in courses %}
                <div class="col-md-4 col-sm-6 col-12">
                  <div class="card mb-3">
                    <div class="card-header text-center">
                      <h5>{{ course.name }}</h5>
                    </div>
                    <div class="card-body">
                      <div class="form-group">
                        <label for="{{ course.name }}">Instructor</label>
                        <select class="custom-select" id="{{ course.name }}" name="{{ course.name }}">
                            <option selected value="Any Instructor">Any Instructor</option>
                            {% for inst in course.instructors %}#}
                                <option value="{{ inst.name }}">{{ inst.name }}</option>
                            {% endfor %}
                        </select>
                      </div>
                      <div class="form-group">
                        <label for="{{ course.name }}Pr">Priority</label>
                        <select class="custom-select" id="{{ course.name }}Pr" name="{{ course.name }}Pr">
                            <option selected value="0">I don't care</option>
                            <option value="1">Preferred Instructor-2</option>
                            <option value="10">Preferred Instructor-1</option>
                            <option value="50">Must-have instructor</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
            {% endfor %}


        </div>
        <div class="row justify-content-center">
            <div class="col-4 ">
                <button id="generateBtn" type="submit" class="btn btn-primary btn-block" name="submit" value="generation">Generate</button>
            </div>
        </div>
    </form>
    <div class="row">
        <div class="col-md-12 text-center">
            <div class="btn-group btn-group btn-group-toggle btn-block" data-toggle="buttons">

                {% for courseNameS,courseName in coursesNames %}
                    <button class="btn btn-no-r btn-no-f btn-secondary port-item" data-toggle="collapse" data-target="#{{courseName}}Sch">{{ courseNameS }}</button>
                {% endfor %}

            </div>
        </div>
    </div>





    <div class="table-responsive">
        {% for schedule,course in allSchedules %}
        <div id="{{ course }}Sch" class="collapse">
            <table class="table" >
                <tr>
                    <th scope="col"></th>
                    <th scope="col">1</th>
                    <th scope="col">2</th>
                    <th scope="col">3</th>
                    <th scope="col">4</th>
                    <th scope="col">5</th>
                    <th scope="col">6</th>
                    <th scope="col">7</th>
                    <th scope="col">8</th>
                    <th scope="col">9</th>
                    <th scope="col">10</th>
                    <th scope="col">11</th>
                    <th scope="col">12</th>
                </tr>
                <tr>
                    <th class="day" scope="row" >Saturday</th>
                    {{ schedule.0.0| safe }}
                    {{ schedule.0.1| safe}}
                    {{ schedule.0.2| safe}}
                    {{ schedule.0.3| safe}}
                    {{ schedule.0.4| safe}}
                    {{ schedule.0.5| safe}}
                    {{ schedule.0.6| safe}}
                    {{ schedule.0.7| safe}}
                    {{ schedule.0.8| safe}}
                    {{ schedule.0.9| safe}}
                    {{ schedule.0.10| safe}}
                    {{ schedule.0.11| safe}}
                </tr>
                <tr>
                    <th class="day" scope="row">Sunday</th>
                    {{ schedule.1.0| safe }}
                    {{ schedule.1.1| safe}}
                    {{ schedule.1.2| safe}}
                    {{ schedule.1.3| safe}}
                    {{ schedule.1.4| safe}}
                    {{ schedule.1.5| safe}}
                    {{ schedule.1.6| safe}}
                    {{ schedule.1.7| safe}}
                    {{ schedule.1.8| safe}}
                    {{ schedule.1.9| safe}}
                    {{ schedule.1.10| safe}}
                    {{ schedule.1.11| safe}}
                </tr>
                <tr>
                    <th class="day" scope="row">Monday</th>
                    {{ schedule.2.0| safe }}
                    {{ schedule.2.1| safe}}
                    {{ schedule.2.2| safe}}
                    {{ schedule.2.3| safe}}
                    {{ schedule.2.4| safe}}
                    {{ schedule.2.5| safe}}
                    {{ schedule.2.6| safe}}
                    {{ schedule.2.7| safe}}
                    {{ schedule.2.8| safe}}
                    {{ schedule.2.9| safe}}
                    {{ schedule.2.10| safe}}
                    {{ schedule.2.11| safe}}
                </tr>
                <tr>
                    <th class="day" scope="row">Tuesday</th>
                    {{ schedule.3.0| safe }}
                    {{ schedule.3.1| safe}}
                    {{ schedule.3.2| safe}}
                    {{ schedule.3.3| safe}}
                    {{ schedule.3.4| safe}}
                    {{ schedule.3.5| safe}}
                    {{ schedule.3.6| safe}}
                    {{ schedule.3.7| safe}}
                    {{ schedule.3.8| safe}}
                    {{ schedule.3.9| safe}}
                    {{ schedule.3.10| safe}}
                    {{ schedule.3.11| safe}}
                </tr>
                <tr>
                    <th class="day" scope="row">Wednesday</th>
                    {{ schedule.4.0| safe }}
                    {{ schedule.4.1| safe}}
                    {{ schedule.4.2| safe}}
                    {{ schedule.4.3| safe}}
                    {{ schedule.4.4| safe}}
                    {{ schedule.4.5| safe}}
                    {{ schedule.4.6| safe}}
                    {{ schedule.4.7| safe}}
                    {{ schedule.4.8| safe}}
                    {{ schedule.4.9| safe}}
                    {{ schedule.4.10| safe}}
                    {{ schedule.4.11| safe}}
                </tr>
                <tr>
                    <th class="day" scope="row">Thursday</th>
                    {{ schedule.5.0| safe }}
                    {{ schedule.5.1| safe}}
                    {{ schedule.5.2| safe}}
                    {{ schedule.5.3| safe}}
                    {{ schedule.5.4| safe}}
                    {{ schedule.5.5| safe}}
                    {{ schedule.5.6| safe}}
                    {{ schedule.5.7| safe}}
                    {{ schedule.5.8| safe}}
                    {{ schedule.5.9| safe}}
                    {{ schedule.5.10| safe}}
                    {{ schedule.5.11| safe}}
                </tr>
            </table>
        </div>
        {% endfor %}
    </div>
{#    <button id="btn-download" class="btn btn-success">Download Schedule</button>#}
    <a id="btn-download" class="btn btn-success" href="#end">Download</a>
    <footer id="end">

    </footer>

</div>
<style>
    td{
        width:100px;
        height:50pt;
        font-size: 13px;
        font-family: "Roboto", "Lucida Grande", "DejaVu Sans", "Bitstream Vera Sans", Verdana, Arial, sans-serif;
    }
    .course-label{
        width: 200px;
    }
    .input-group{
        margin: 10px;
    }
    #generateBtn{
        margin:20px;
    }
    .sliders {
        -webkit-appearance: none;
        width: 100%;
        height: 15px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .sliders::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #007bff;
        cursor: pointer;
    }

    .sliders::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }
    .mb-3{
        margin:20px;
    }
</style>
<script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
{#<script src="{% static "html2canvas.js" %}" type="text/javascript"></script>#}
<script>


    $(document).ready(function () {
        {#var element = $("#html-content-holder"); // global variable#}
        {#let getCanvas; // global variable#}
        var element // global variable
        var getCanvas; // global variable
        var firstClick = false;

        $("#btn-download").on('click', function (evt) {
            element = $(".show").first();
            html2canvas(element, {
             onrendered: function (canvas) {
                    getCanvas = canvas;
                    console.log("done")
                 }
             });
            var imgageData = getCanvas.toDataURL("image/png");
            // Now browser starts downloading it instead of just showing it
            var newData = imgageData.replace(/^data:image\/png/, "data:application/octet-stream");
            $("#btn-download").attr("download", element.attr('id')+".png").attr("href", newData);
        });

        $('.port-item').click( async function(e) {
            $('.collapse').collapse('hide');
            $('.active').removeClass("active");
            $(".port-item").not(this).attr("disabled", true);
            await sleep(250);
            $(".port-item").not(this).attr("disabled", false);
            $("#btn-download").click();
        });

        function sleep(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
        }

    });


</script>
</body>
</html>